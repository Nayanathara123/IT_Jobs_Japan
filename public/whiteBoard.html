<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5 JS White Board</title>
  <meta name="description" content="The HTML5 JS Whiteboard">
  <meta name="author" content="Test">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <link rel="stylesheet" href="style.css">

</head>

<body>
<!-- <p class="content_append"></p> -->
<div class="toolSection" id="toolSection">

    <button id="freeTool" type="submit" onclick="drawFreeTool()" style="background-color: #007bff">Free Draw Tool</button>
    <button id="red" class="color">Red</button>
    <button id="green" class="color">Green</button>
    <button id="blue" class="color">Blue</button>
    <button id="black" class="color">Black</button>
    <button id="darkgrey" class="color" style="background-color: #323538">darkgrey</button>
    <button id="grey" class="color" style="background-color: #626467">grey</button>
    <button id="lightgrey" class="color" style="background-color: #959698">lightgrey</button>
    <textarea name="backup" id="backup" cols="60" rows="10" style="display: none;"></textarea>   
    <p id="redraw-count" style="display: none;">0</p>
    <button id="clear" style="display: none;">Clear canvas</button>
    <button id="save" style="display: none;">Save canvas</button>
    <button id="restore" style="display: none;">Restore canvas</button>
    <button id="bucket" style="display: none;">Bucket</button> 
    <button id="disable" style="display: none;">Disable</button>
    <button id="enable" style="display: none;">Enable</button> 
    <button id="undo" style="display: none;">Undo</button>
    <button id="redo" style="display: none;">Redo</button> 
    <input id="tolerance" type="text" style="display: none;"/>

    </br></br>

  <button id="circle" type="submit" onclick="selectTextBox()" style="background-color: #007bff">Text Box</button>
  <button id="circle" type="submit" onclick="selectCircle()" style="background-color: #007bff">Circle</button>
  <button id="line" type="submit" onclick="selectLine()" style="background-color: #007bff">Line</button>

  <!-- <span>Type text to for your drawn rectangle</span> -->
	<input id="sourceText1" type="text" class="sourceText" style="display: none;">
	<button id="save" type="submit" onclick="sendWork()" style="background-color: #28a745">Save Your Work</button>
    <br>
</div>

<div class="wrapper">
  <!-- <input type="text" id="canvas_text2" style="position:absolute; left=?; top=?;" /> -->
  <textarea id="canvas_text2" style="position:absolute; left=?; top=?;" rows="4" cols="50"></textarea>
  <canvas id="whiteBoard2" width="800" height="1200"></canvas>

	<canvas id="whiteBoard" width="800" height="1200"></canvas>
 <!--  <input type="text" id="canvas_text" style="position:absolute; left=?; top=?;" /> -->
  <textarea id="canvas_text" style="position:absolute; left=?; top=?;" rows="4" cols="50"></textarea>
</div>
	
	
 <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
 <script type="text/javascript" src="https://code.jquery.com/jquery.min.js"></script> 

 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

 <script src="whiteboard_canvas.js"></script>

 <script src="canvas-free-drawing.js"></script>

 <script src="fabric.min.js"></script>

  <script>

    function drawFreeTool(){

      freeDrawTool = true; 
      drawLineCheck = false;
      drawCircleCheck = false;

      const cfd = new CanvasFreeDrawing.default({
        elementId: 'whiteBoard',
        width: 500,
        height: 500,
        showWarnings: true,
        lineWidth : 2,
        x : 0
      });
      const redrawCount = document.getElementById('redraw-count');
      cfd.on({ event: 'redraw', counter: 0 }, () => {
        redrawCount.innerText = parseInt(redrawCount.innerText) + 1;
      });
      const textarea = document.getElementById('backup');
      document
        .getElementById('clear')
        .addEventListener('click', () => cfd.clear());
      document
        .getElementById('disable')
        .addEventListener('click', () => cfd.disableDrawingMode());
      document
        .getElementById('enable')
        .addEventListener('click', () => cfd.enableDrawingMode());
      document.getElementById('save').addEventListener('click', () => {
        textarea.value = cfd.save();
      });
      document.getElementById('restore').addEventListener('click', () => {
        cfd.restore(textarea.value);
      });
      document.getElementById('undo').addEventListener('click', () => cfd.undo());
      document.getElementById('redo').addEventListener('click', () => cfd.redo());
      document.getElementById('bucket').addEventListener('click', () => {
        cfd.configBucketTool({
          tolerance: document.getElementById('tolerance').value,
        });
        const isActive = cfd.toggleBucketTool();
        document.getElementById('bucket').classList.add('active');
        if (isActive) {
        } else {
          document.getElementById('bucket').classList.remove('active');
        }
      });
      document
        .getElementById('red')
        .addEventListener('click', () => cfd.setDrawingColor([255, 0, 0]));
      document
        .getElementById('green')
        .addEventListener('click', () => cfd.setDrawingColor([0, 255, 0]));
      document
        .getElementById('blue')
        .addEventListener('click', () => cfd.setDrawingColor([0, 0, 255]));
      document
        .getElementById('black')
        .addEventListener('click', () => cfd.setDrawingColor([0, 0, 0]));
      document
        .getElementById('darkgrey')
        .addEventListener('click', () => cfd.setDrawingColor([50, 50, 50]));
      document
        .getElementById('grey')
        .addEventListener('click', () => cfd.setDrawingColor([100, 100, 100]));
      document
        .getElementById('lightgrey')
        .addEventListener('click', () => cfd.setDrawingColor([150, 150, 150]));

    }
  </script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
      var socket = io();

      function sendWork() {

        var textBoxOriText = $('#canvas_text').val().replace(/\s/g, '%20');
        var passingURL = "https://rapidapi.p.rapidapi.com/api/get?langpair=en%7Cja&q="+ textBoxOriText +"&mt=1&onlyprivate=0&de=a%40b.c"

        const settings = {
          "async": true,
          "crossDomain": true,
          // "url": "https://rapidapi.p.rapidapi.com/api/get?langpair=en%7Cja&q=Mother%20Father!&mt=1&onlyprivate=0&de=a%40b.c",
          "url": passingURL,
          "method": "GET",
          "headers": {
            "x-rapidapi-host": "translated-mymemory---translation-memory.p.rapidapi.com",
            "x-rapidapi-key": "9d4ac67208mshe0921b379f9c0f9p186b64jsna910dee8a1ae"
          }
        };

        $.ajax(settings).done(function (response) {
          console.log(response);
          //alert(response.responseData.translatedText);

          var txtArea = document.getElementById("canvas_text");
          txtArea.value =  $('#canvas_text').val() + '\r\n' + response.responseData.translatedText;
          $('#canvas_text').val(txtArea.value);
        });

        window.setTimeout(socketEmit, 1800);       
      }

      function socketEmit(){

        var textBoxVal = $('#canvas_text').val();
        var rectangleBuild = {startX:rect.startX,startY:rect.startY,width:rect.w,height:rect.h,text:textBoxVal}
        //alert(textBoxVal);
        //const jsonData = JSON.stringify(rectangleBuild);//canvas.toDataURL();
        socket.emit('chat message', rectangleBuild);
        //alert(jsonData);
        
        return false;
      }

     $(function () {

      //var tabHeight = $(window).height() - $(window).innerHeight + $('#toolSection').height();
        socket.on('chat message', function(msg){
                //alert(msg);
            //$('.content_append').append($('<p>').text(msg.startX));
            //alert(msg.text);
            var canvas=document.getElementById('whiteBoard');
            var context=canvas.getContext('2d');
            context.strokeStyle = 'black';
            context.lineWidth = 1;
            context.font = "14px Arial";
            context.strokeRect(msg.startX-300, msg.startY-132, msg.width, msg.height);
            context.fillText(msg.text, msg.startX-300+10, msg.startY-132+(msg.height/3));

            //removeTextAllNodes(context,msg.text);
        }); 
      });

     // function removeTextAllNodes(context,text){
     //    var oldVal = text;
    
     //    var checkLength = function (val) {
     //        context.fillText('', msg.startX-300+10, msg.startY-132+(msg.height/3));
     //    }

     //    $('#canvas_text').bind('DOMAttrModified textInput input change keypress paste', function () {
     //        var val = $('#canvas_text').value;
     //        if (val !== oldVal) {
     //            oldVal = val;
     //            checkLength(val);
     //        }
     //    });
     // }
     
        
  </script>
</body>
</html>